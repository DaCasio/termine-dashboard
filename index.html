<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info-Board Termine</title>
    <style>
        body {
            background-color: #0b0e14; /* Dunkler Weltraum-Grund */
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 600px;
        }

        h1 { color: #4a9eff; text-align: center; }

        /* Suchleiste Style */
        .search-container {
            margin-bottom: 20px;
        }

        #suche {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #333;
            background-color: #1a1d23;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
        }

        #suche:focus { border-color: #4a9eff; box-shadow: 0 0 8px rgba(74, 158, 255, 0.3); }

        /* Termin-Karten */
        .termin-item {
            background: #1a1d23;
            border-left: 5px solid #4a9eff;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .termin-item:hover { transform: translateY(-2px); }

        .termin-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .termin-notiz {
            font-size: 0.9em;
            color: #aaaaaa;
            white-space: pre-wrap; /* Wichtig f√ºr Zeilenumbr√ºche in Notizen */
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #333;
        }

        /* Eingabe-Bereich */
        .input-group {
            background: #1a1d23;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #0b0e14;
            border: 1px solid #333;
            color: white;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }

        button:hover { background: #357abd; }

        .btn-delete { background: #ff4a4a; margin-top: 5px; }
        .btn-edit { background: #ffae4a; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üìÖ Termin-Board</h1>

    <div class="search-container">
        <input type="text" id="suche" placeholder="Termine oder Notizen durchsuchen..." onkeyup="filtereTermine()">
    </div>

    <div id="termine-liste">
        Lade Termine...
    </div>

    <hr>

    <div class="input-group">
        <h3>Neuen Termin anlegen / bearbeiten</h3>
        <input type="hidden" id="edit-index" value="-1">
        <input type="text" id="new-name" placeholder="Was steht an?">
        <input type="datetime-local" id="new-date">
        <textarea id="new-note" rows="3" placeholder="Zusatzinfos (Notizen)..."></textarea>
        <button onclick="speichereTermin()">Termin Speichern</button>
    </div>
</div>

<script>
    const GITHUB_TOKEN = 'DEIN_PERSONAL_ACCESS_TOKEN'; // Hier dein Token einsetzen
    const REPO_OWNER = 'DaCasio';
    const REPO_NAME = 'info-board';
    const FILE_PATH = 'termine.json';

    let termineDaten = [];

    // 1. Daten laden
    async function ladeDaten() {
        const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`;
        try {
            const res = await fetch(url, {
                headers: { 'Authorization': `token ${GITHUB_TOKEN}`, 'Accept': 'application/vnd.github.v3.raw' }
            });
            termineDaten = await res.json();
            rendereTermine();
        } catch (e) {
            console.error("Fehler beim Laden:", e);
            document.getElementById('termine-liste').innerHTML = "Fehler beim Laden der Daten.";
        }
    }

    // 2. Termine anzeigen
    function rendereTermine() {
        const liste = document.getElementById('termine-liste');
        liste.innerHTML = '';

        // Sortieren nach Datum
        termineDaten.sort((a, b) => new Date(a.ziel) - new Date(b.ziel));

        termineDaten.forEach((t, index) => {
            const datum = new Date(t.ziel).toLocaleString('de-DE', { 
                day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' 
            });

            const div = document.createElement('div');
            div.className = 'termin-item';
            div.innerHTML = `
                <div class="termin-header">
                    <span>${t.name}</span>
                    <span style="color: #4a9eff;">${datum}</span>
                </div>
                ${t.notiz ? `<div class="termin-notiz">${t.notiz}</div>` : ''}
                <button class="btn-edit" onclick="editTermin(${index})">Bearbeiten</button>
                <button class="btn-delete" onclick="loescheTermin(${index})">L√∂schen</button>
            `;
            liste.appendChild(div);
        });
    }

    // 3. NEU: Filtern
    function filtereTermine() {
        const filter = document.getElementById('suche').value.toLowerCase();
        const items = document.getElementsByClassName('termin-item');

        Array.from(items).forEach(item => {
            const text = item.innerText.toLowerCase();
            item.style.display = text.includes(filter) ? "" : "none";
        });
    }

    // 4. Speichern (Hinzuf√ºgen oder Editieren)
    async function speichereTermin() {
        const n = document.getElementById('new-name').value;
        const d = document.getElementById('new-date').value;
        const note = document.getElementById('new-note').value;
        const idx = document.getElementById('edit-index').value;

        if (!n || !d) { alert("Name und Datum fehlen!"); return; }

        const neuerEintrag = { name: n, ziel: d, notiz: note };

        if (idx === "-1") {
            termineDaten.push(neuerEintrag);
        } else {
            termineDaten[idx] = neuerEintrag;
        }

        await pushToGithub();
        resetForm();
    }

    // 5. L√∂schen
    async function loescheTermin(index) {
        if (!confirm("Termin wirklich l√∂schen?")) return;
        termineDaten.splice(index, 1);
        await pushToGithub();
    }

    // 6. Bearbeitungs-Modus
    function editTermin(index) {
        const t = termineDaten[index];
        document.getElementById('new-name').value = t.name;
        document.getElementById('new-date').value = t.ziel;
        document.getElementById('new-note').value = t.notiz || "";
        document.getElementById('edit-index').value = index;
        window.scrollTo(0, document.body.scrollHeight);
    }

    function resetForm() {
        document.getElementById('new-name').value = '';
        document.getElementById('new-date').value = '';
        document.getElementById('new-note').value = '';
        document.getElementById('edit-index').value = "-1";
    }

    // 7. Push zu GitHub API
    async function pushToGithub() {
        const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`;
        
        // Erst das aktuelle SHA holen
        const resOld = await fetch(url, {
            headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
        });
        const dataOld = await resOld.json();
        const sha = dataOld.sha;

        const content = btoa(unescape(encodeURIComponent(JSON.stringify(termineDaten, null, 4))));

        await fetch(url, {
            method: 'PUT',
            headers: { 'Authorization': `token ${GITHUB_TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message: "Update termine.json via Board",
                content: content,
                sha: sha
            })
        });
        
        rendereTermine();
    }

    // Start
    ladeDaten();
</script>

</body>
</html>
